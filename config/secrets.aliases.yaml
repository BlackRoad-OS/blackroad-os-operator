# secrets.aliases.yaml
# BlackRoad OS - Credentials Registry
#
# This file is SAFE TO COMMIT - it contains NO actual secrets.
# It maps logical aliases to environment variable names with OWNER and SCOPE.
#
# KEY CONCEPT: API key = CAPABILITY, PS-SHA∞ fingerprint = IDENTITY
# - Credentials grant capability (call OpenAI, deploy to Railway)
# - Identity is who's doing it (Cece, agent-001, lucidia-pi cluster)
#
# Pattern: Only the Operator holds real secrets.
# Everyone else (agents, workers, packs) uses aliases via governed API calls.
#
# @owner Alexa Louise Amundson
# @system BlackRoad OS
# @version credentials-v2

version: "credentials-v2"

# =============================================================================
# OWNERSHIP SCHEMA
# =============================================================================
#
# Each credential has:
#   - owner: Who owns/manages this credential (person or org)
#   - scope: core | research | tenant | external | deprecated
#   - allowed_agents: Which agent IDs can use this (empty = all governed agents)
#   - allowed_intents: Which intent types can trigger use (empty = all)
#
# Scopes:
#   core       - Essential infrastructure (Cece, operator, mesh)
#   research   - R&D / experimental (can be rotated freely)
#   tenant     - Per-customer isolation (future multi-tenant)
#   external   - Third-party integrations (GitHub, Slack, etc.)
#   deprecated - Scheduled for removal (warns on use)
#

# Where secrets actually live (the "secrets perimeter")
perimeter:
  production:
    - service: blackroad-cece-operator
      platform: railway
      project_id: d8eed902-91eb-44f6-aa5c-68acf0328ace

  local:
    - file: ~/.blackroad/secrets.env
    - file: .env

# =============================================================================
# LLM PROVIDERS
# =============================================================================

providers:
  openai:
    default:
      env_var: OPENAI_API_KEY
      description: "Primary OpenAI key for Cece operator"
      required: true
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - "*"  # All agents (governed)
      allowed_intents:
        - chat
        - completion
        - embedding
      used_by:
        - br_operator.llm_service
        - intents.*

    embeddings:
      env_var: OPENAI_API_KEY  # Same key, different alias for clarity
      description: "OpenAI embeddings for RAG"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_intents:
        - embedding
        - rag_query

  anthropic:
    default:
      env_var: ANTHROPIC_API_KEY
      description: "Anthropic Claude API for multi-model routing"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - "*"
      allowed_intents:
        - chat
        - completion
      used_by:
        - br_operator.llm_service

  ollama:
    local:
      env_var: OLLAMA_HOST
      description: "Local Ollama endpoint (not a secret, but consistent pattern)"
      default: "http://localhost:11434"
      required: false
      owner: "Alexa Louise Amundson"
      scope: research
      allowed_agents:
        - "*"  # Any agent on local clusters

# =============================================================================
# INFRASTRUCTURE - These are BlackRoad-owned deployment tools
# =============================================================================

  cloudflare:
    api_token:
      env_var: CLOUDFLARE_API_TOKEN
      description: "Cloudflare API token for Workers/KV/D1"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - infra-deployer
      allowed_intents:
        - deploy
        - kv_write
        - d1_migrate
      used_by:
        - infra.deploy

    account_id:
      env_var: CLOUDFLARE_ACCOUNT_ID
      description: "Cloudflare account ID"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core

  railway:
    token:
      env_var: RAILWAY_TOKEN
      description: "Railway API token for deployments"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - infra-deployer
      allowed_intents:
        - deploy
        - scale
        - restart

  digitalocean:
    token:
      env_var: DIGITALOCEAN_ACCESS_TOKEN
      description: "DigitalOcean API token"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - infra-deployer

    ssh_key:
      env_var: DROPLET_SSH_KEY
      description: "SSH private key for droplet access"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      sensitive: true
      allowed_agents:
        - cece-primary  # Only Cece can SSH directly

# =============================================================================
# PAYMENTS & BILLING - Critical financial capability
# =============================================================================

  stripe:
    secret:
      env_var: STRIPE_SECRET_KEY
      description: "Stripe secret key for billing"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - billing-agent
      allowed_intents:
        - create_checkout
        - create_subscription
        - process_webhook
      used_by:
        - workers.billing
        - gateway.stripe-worker

    publishable:
      env_var: STRIPE_PUBLISHABLE_KEY
      description: "Stripe publishable key (client-safe)"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      sensitive: false  # Can be exposed to frontend

    webhook_secret:
      env_var: STRIPE_WEBHOOK_SECRET
      description: "Stripe webhook signing secret"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - billing-agent
      allowed_intents:
        - process_webhook

# =============================================================================
# INTEGRATIONS - External tools Cece can use
# =============================================================================

  github:
    token:
      env_var: GITHUB_TOKEN
      description: "GitHub personal access token"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_agents:
        - cece-primary
        - github-agent
      allowed_intents:
        - repo_read
        - repo_write
        - pr_create
        - issue_create
      used_by:
        - agents.github

    app_private_key:
      env_var: GITHUB_APP_PRIVATE_KEY
      description: "GitHub App private key for org-level access"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      sensitive: true
      allowed_agents:
        - cece-primary  # Only Cece for org-level ops

  slack:
    bot_token:
      env_var: SLACK_BOT_TOKEN
      description: "Slack bot OAuth token"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_agents:
        - cece-primary
        - slack-agent
        - notification-agent
      allowed_intents:
        - send_message
        - read_channel
      used_by:
        - agents.slack
        - notifications

    webhook_url:
      env_var: SLACK_WEBHOOK_URL
      description: "Slack incoming webhook for alerts"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_intents:
        - send_alert

  notion:
    api_key:
      env_var: NOTION_API_KEY
      description: "Notion integration token"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_agents:
        - cece-primary
        - notion-agent
        - research-agent
      allowed_intents:
        - page_read
        - page_write
        - database_query
      used_by:
        - agents.notion
        - packs.research

  linear:
    api_key:
      env_var: LINEAR_API_KEY
      description: "Linear API key for issue tracking"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_agents:
        - cece-primary
        - linear-agent
      allowed_intents:
        - issue_create
        - issue_update
        - project_read
      used_by:
        - agents.linear

  asana:
    token:
      env_var: ASANA_ACCESS_TOKEN
      description: "Asana personal access token"
      required: false
      owner: "Alexa Louise Amundson"
      scope: external
      allowed_agents:
        - cece-primary
        - asana-agent

# =============================================================================
# DATABASES - Data layer capabilities
# =============================================================================

  postgres:
    url:
      env_var: DATABASE_URL
      description: "Primary PostgreSQL connection string"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      sensitive: true
      allowed_agents:
        - cece-primary
        - ledger-agent
      allowed_intents:
        - db_read
        - db_write
        - ledger_append

  redis:
    url:
      env_var: REDIS_URL
      description: "Redis connection string"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - "*"  # All agents can use cache
      allowed_intents:
        - cache_read
        - cache_write

  pinecone:
    api_key:
      env_var: PINECONE_API_KEY
      description: "Pinecone vector DB API key"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
        - rag-agent
      allowed_intents:
        - vector_upsert
        - vector_query

# =============================================================================
# INTERNAL / MESH - BlackRoad infrastructure secrets
# =============================================================================

  blackroad:
    root_secret:
      env_var: BR_ROOT_SECRET
      description: "PS-SHA∞ root secret for identity derivation"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      sensitive: true
      allowed_agents: []  # NO agents - Operator only

    internal_signing_key:
      env_var: BR_INTERNAL_SIGNING_KEY
      description: "Internal JWT signing key for service-to-service auth"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      sensitive: true
      allowed_agents:
        - cece-primary  # Only Cece signs internal requests

    webhook_secret:
      env_var: BR_WEBHOOK_SECRET
      description: "Secret for validating incoming webhooks"
      required: false
      owner: "Alexa Louise Amundson"
      scope: core
      allowed_agents:
        - cece-primary
      allowed_intents:
        - webhook_verify

# =============================================================================
# GOVERNANCE - Access control rules
# =============================================================================

# Which aliases require policy evaluation before use
governed_aliases:
  - openai.default
  - anthropic.default
  - stripe.secret
  - github.token
  - notion.api_key
  - slack.bot_token

# Aliases that can be used without policy check (internal/infra)
ungoverned_aliases:
  - cloudflare.api_token
  - railway.token
  - postgres.url
  - redis.url
  - blackroad.internal_signing_key

# Scope priorities (which scope can override which)
scope_hierarchy:
  - core       # Highest - BlackRoad infrastructure
  - external   # Third-party integrations
  - research   # R&D / experimental
  - tenant     # Per-customer isolation
  - deprecated # Scheduled for removal

# =============================================================================
# TENANT CREDENTIALS (Future - Multi-tenant isolation)
# =============================================================================
#
# When tenants bring their own keys, they go here:
#
# tenant_credentials:
#   tenant_001:
#     openai:
#       env_var: TENANT_001_OPENAI_KEY
#       owner: "Tenant 001"
#       scope: tenant
#       allowed_agents:
#         - tenant_001_agent
#       isolation: strict  # Never mix with core traffic
#
# IMPORTANT: Tenant keys are NEVER rolled into PS-SHA∞ identity.
# They're ephemeral limbs, not soul ingredients.
#

# =============================================================================
# CREDENTIAL LIFECYCLE
# =============================================================================
#
# Credentials can be in these states:
#   active     - Normal use
#   rotating   - Being replaced (both old and new work)
#   disabled   - Temporarily disabled
#   deprecated - Marked for removal, warns on use
#   revoked    - Permanently disabled
#
# credential_states:
#   openai.default: active
#   anthropic.default: active
#   # ... etc
