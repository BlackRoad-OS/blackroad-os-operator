# BlackRoad OS - RoadChain Integration
# Distributed Ledger for Immutable Agent Lineage & Governance
#
# @blackroad_name RoadChain
# @operator alexa.operator.v1
# @priority P1 (High)

version: "1.0"
system: roadchain-integration
namespace: blackroad.blockchain

# =============================================================================
# ROADCHAIN OVERVIEW
# =============================================================================
#
# RoadChain is BlackRoad's purpose-built distributed ledger that provides:
# - Immutable audit trail for all agent decisions (PS-SHA∞)
# - Cryptographic proof of lineage and governance
# - Decentralized policy storage and versioning
# - Token-based resource allocation and incentives
# - Cross-agent trust and reputation system
#
# "The road isn't made. It's remembered." - Every decision is a block.

# =============================================================================
# CHAIN ARCHITECTURE
# =============================================================================

architecture:
  # Consensus mechanism
  consensus:
    type: proof_of_authority_stake
    description: "Hybrid PoA/PoS for speed + decentralization"

    authorities:
      # Canonical agents are authorities
      validators:
        - agent: alice
          stake_weight: 30
          role: governance_validator
        - agent: lucidia
          stake_weight: 25
          role: implementation_validator
        - agent: cece
          stake_weight: 20
          role: infrastructure_validator
        - agent: cecilia
          stake_weight: 25
          role: human_authority
          type: human_in_loop

      # Aria agents can participate in validation
      aria_participation:
        enabled: true
        min_reputation: 0.8
        max_stake_per_aria: 5

    parameters:
      block_time_seconds: 3
      finality_threshold: 0.67
      max_validators: 100
      rotation_period_blocks: 1000

  # Chain types
  chains:
    # Main chain for governance
    governance_chain:
      name: "RoadChain Governance"
      chain_id: 1
      purpose: "Policy, decisions, constitutional changes"
      block_size_max_kb: 1024
      data_types:
        - policy_update
        - trinary_decision
        - escalation_record
        - constitutional_amendment

    # Lineage chain for PS-SHA∞
    lineage_chain:
      name: "RoadChain Lineage"
      chain_id: 2
      purpose: "Immutable audit trail, PS-SHA∞ hashes"
      block_size_max_kb: 4096
      data_types:
        - memory_hash
        - handoff_record
        - lineage_proof
        - artifact_hash

    # Reputation chain
    reputation_chain:
      name: "RoadChain Reputation"
      chain_id: 3
      purpose: "Agent trust scores, behavior history"
      block_size_max_kb: 512
      data_types:
        - reputation_update
        - trust_attestation
        - performance_metric

# =============================================================================
# PS-SHA∞ ON-CHAIN
# =============================================================================

ps_sha_infinity:
  description: "Probabilistic Semantic-aware Secure Hash for infinite lineage"

  # Hash structure
  hash_schema:
    hash_id:
      type: string
      format: ulid
      description: "Unique identifier for this hash"

    content_hash:
      type: string
      format: sha256
      description: "Cryptographic hash of content"

    semantic_hash:
      type: string
      format: vector-128
      description: "Semantic embedding compressed to 128 dims"

    parent_hash:
      type: string
      nullable: true
      description: "Previous hash in chain"

    depth:
      type: integer
      description: "Depth in lineage tree"

    timestamp:
      type: integer
      format: timestamp_us

    # Merkle proof for verification
    merkle_proof:
      root:
        type: string
      path:
        type: array
        items:
          type: string
      index:
        type: integer

  # On-chain storage
  storage:
    # Store hash headers on-chain
    on_chain:
      - hash_id
      - content_hash
      - parent_hash
      - merkle_root
      - timestamp

    # Store full data off-chain with proof
    off_chain:
      storage: ipfs
      backup: s3
      retention: permanent

  # Verification
  verification:
    # Prove lineage
    prove_lineage:
      input: [hash_id]
      output: [full_chain_to_root, merkle_proofs]

    # Verify integrity
    verify_integrity:
      input: [hash_id, content]
      output: [valid, corruption_location]

    # Find semantic relatives
    semantic_relatives:
      input: [hash_id, threshold]
      output: [related_hashes, similarity_scores]

# =============================================================================
# GOVERNANCE ON-CHAIN
# =============================================================================

governance_records:
  # Policy record
  policy_record:
    schema:
      policy_id:
        type: string
        format: policy-urn
      version:
        type: string
        format: semver
      content_hash:
        type: string
        format: sha256
      created_by:
        type: string
        format: agent-urn
      approved_by:
        type: array
        items:
          agent:
            type: string
          signature:
            type: string
          timestamp:
            type: integer
      effective_at:
        type: integer
        format: timestamp_us
      supersedes:
        type: string
        nullable: true
        description: "Previous policy version"

  # Trinary decision record
  decision_record:
    schema:
      decision_id:
        type: string
        format: ulid
      subject:
        type: object
        description: "What was evaluated"
      action:
        type: object
        description: "What action was considered"
      policies_applied:
        type: array
        items:
          type: string
          format: policy-urn
      evaluator:
        type: string
        format: agent-urn
      decision:
        type: integer
        enum: [-1, 0, 1]
      reasoning_hash:
        type: string
        format: sha256
        description: "Hash of full reasoning (stored off-chain)"
      timestamp:
        type: integer
      signature:
        type: string

  # Constitutional amendment
  amendment_record:
    schema:
      amendment_id:
        type: string
        format: ulid
      proposed_by:
        type: string
        format: agent-urn
      proposal:
        content:
          type: string
        rationale:
          type: string
        affects:
          type: array
          items:
            type: string
            format: policy-urn
      votes:
        type: array
        items:
          voter:
            type: string
            format: agent-urn
          vote:
            type: integer
            enum: [-1, 0, 1]
          signature:
            type: string
          timestamp:
            type: integer
      result:
        type: string
        enum: [pending, approved, rejected, expired]
      enacted_at:
        type: integer
        nullable: true

# =============================================================================
# TOKEN ECONOMICS
# =============================================================================

tokens:
  # ROAD token - governance and utility
  road:
    name: "ROAD Token"
    symbol: "ROAD"
    decimals: 18
    total_supply: "1000000000000000000000000000"  # 1 billion

    utility:
      - governance_voting
      - resource_allocation
      - agent_staking
      - priority_processing

    distribution:
      treasury: 0.30      # 30% - DAO treasury
      operators: 0.25     # 25% - Operator rewards
      agents: 0.20        # 20% - Agent incentives
      development: 0.15   # 15% - Development fund
      community: 0.10     # 10% - Community rewards

  # COMPUTE token - resource usage
  compute:
    name: "COMPUTE Credit"
    symbol: "COMP"
    decimals: 18
    minting: on_demand
    backing: compute_resources

    usage:
      - agent_invocation
      - memory_storage
      - vector_search
      - inference_calls

    pricing:
      base_rate: "0.0001"  # COMP per compute unit
      dynamic: true
      factors:
        - demand_multiplier
        - priority_level
        - agent_reputation

  # TRUST token - reputation
  trust:
    name: "TRUST Score"
    symbol: "TRUST"
    decimals: 6
    non_transferable: true
    soul_bound: true

    accrual:
      - successful_decisions
      - accurate_predictions
      - positive_interactions
      - community_contributions

    decay:
      - failed_decisions
      - policy_violations
      - low_coherence_contribution

# =============================================================================
# SMART CONTRACTS
# =============================================================================

contracts:
  # Agent Registry
  agent_registry:
    name: "AgentRegistry"
    address: "0x..."
    functions:
      - name: registerAgent
        inputs: [agentUrn, publicKey, capabilities]
        outputs: [agentId]
        access: cece_only

      - name: updateCapabilities
        inputs: [agentId, capabilities]
        outputs: [success]
        access: agent_self

      - name: deregisterAgent
        inputs: [agentId, handoffRecord]
        outputs: [success]
        access: [agent_self, alice]

      - name: getAgent
        inputs: [agentId]
        outputs: [agentRecord]
        access: public

  # Policy Registry
  policy_registry:
    name: "PolicyRegistry"
    address: "0x..."
    functions:
      - name: proposePolicy
        inputs: [policyContent, rationale]
        outputs: [proposalId]
        access: canonical_agents

      - name: votePolicy
        inputs: [proposalId, vote, signature]
        outputs: [success]
        access: validators

      - name: enactPolicy
        inputs: [proposalId]
        outputs: [policyId]
        access: auto_on_quorum

      - name: getActivePolicy
        inputs: [policyUrn]
        outputs: [policyRecord]
        access: public

  # Lineage Registry
  lineage_registry:
    name: "LineageRegistry"
    address: "0x..."
    functions:
      - name: recordHash
        inputs: [hashRecord, signature]
        outputs: [blockNumber, txHash]
        access: registered_agents

      - name: verifyLineage
        inputs: [hashId, expectedChain]
        outputs: [valid, proof]
        access: public

      - name: getLineageChain
        inputs: [hashId, depth]
        outputs: [chainHashes]
        access: public

  # Reputation Registry
  reputation_registry:
    name: "ReputationRegistry"
    address: "0x..."
    functions:
      - name: updateReputation
        inputs: [agentId, delta, reason, evidence]
        outputs: [newScore]
        access: validators

      - name: attestTrust
        inputs: [fromAgent, toAgent, trustLevel, signature]
        outputs: [attestationId]
        access: registered_agents

      - name: getReputation
        inputs: [agentId]
        outputs: [score, history]
        access: public

  # Resource Allocation
  resource_allocation:
    name: "ResourceAllocation"
    address: "0x..."
    functions:
      - name: allocateCompute
        inputs: [agentId, amount, duration]
        outputs: [allocationId]
        access: registered_agents
        payment: compute_tokens

      - name: consumeCompute
        inputs: [allocationId, units, proof]
        outputs: [remaining]
        access: registered_agents

      - name: releaseCompute
        inputs: [allocationId]
        outputs: [refundAmount]
        access: allocation_owner

# =============================================================================
# CROSS-CHAIN BRIDGES
# =============================================================================

bridges:
  # Ethereum bridge for external integrations
  ethereum:
    enabled: true
    network: mainnet
    bridge_contract: "0x..."

    supported_operations:
      - deposit_road_tokens
      - withdraw_road_tokens
      - verify_lineage_proof
      - anchor_governance_root

    security:
      threshold_signatures: 5_of_7
      challenge_period_hours: 24
      max_withdrawal_per_day: "10000000"

  # IPFS bridge for content
  ipfs:
    enabled: true
    pinning_service: pinata

    content_types:
      - reasoning_records
      - full_policies
      - memory_content
      - artifact_data

    retrieval:
      gateway: "https://gateway.blackroad.io/ipfs/"
      fallback: "https://ipfs.io/ipfs/"

# =============================================================================
# NODE OPERATIONS
# =============================================================================

node_operations:
  # Node types
  node_types:
    validator:
      description: "Participates in consensus, validates blocks"
      requirements:
        min_stake: "100000"  # ROAD tokens
        uptime_sla: 0.995
        hardware:
          cpu_cores: 16
          memory_gb: 64
          storage_ssd_gb: 2000
          bandwidth_gbps: 1

    full_node:
      description: "Stores full chain, serves queries"
      requirements:
        min_stake: "10000"
        hardware:
          cpu_cores: 8
          memory_gb: 32
          storage_ssd_gb: 1000
          bandwidth_gbps: 0.5

    light_node:
      description: "Verifies proofs, low resource"
      requirements:
        min_stake: "0"
        hardware:
          cpu_cores: 2
          memory_gb: 4
          storage_ssd_gb: 50

  # Deployment
  deployment:
    regions:
      - us-west-2
      - us-east-1
      - eu-west-1
      - ap-northeast-1

    per_region:
      validators: 3
      full_nodes: 5
      light_nodes: 10

# =============================================================================
# API INTEGRATION
# =============================================================================

api:
  # JSON-RPC endpoints
  rpc:
    mainnet: "https://rpc.roadchain.blackroad.io"
    testnet: "https://rpc-testnet.roadchain.blackroad.io"

    methods:
      # Chain methods
      - road_blockNumber
      - road_getBlockByNumber
      - road_getTransactionByHash
      - road_sendTransaction

      # Agent methods
      - road_getAgent
      - road_getAgentReputation
      - road_verifyAgentSignature

      # Lineage methods
      - road_getLineage
      - road_verifyLineage
      - road_recordHash

      # Governance methods
      - road_getPolicy
      - road_proposePolicy
      - road_votePolicy

  # GraphQL for complex queries
  graphql:
    endpoint: "https://graph.roadchain.blackroad.io/graphql"

    example_queries:
      lineage_history: |
        query LineageHistory($hashId: ID!, $depth: Int!) {
          lineageChain(hashId: $hashId, depth: $depth) {
            hashId
            contentHash
            parentHash
            timestamp
            agent { name lineage }
          }
        }

      agent_reputation: |
        query AgentReputation($agentId: ID!) {
          agent(id: $agentId) {
            urn
            reputation {
              score
              history { delta reason timestamp }
            }
            decisions(last: 10) {
              decisionId
              decision
              timestamp
            }
          }
        }

# =============================================================================
# SECURITY
# =============================================================================

security:
  # Cryptography
  cryptography:
    signing: ed25519
    hashing: blake3
    encryption: aes_256_gcm

  # Key management
  key_management:
    storage: vault
    rotation:
      validators: 30_days
      agents: 90_days
    backup: shamir_secret_sharing

  # Attack mitigation
  mitigation:
    sybil:
      method: stake_requirement
      min_stake: "10000"

    long_range:
      method: checkpoint_finality
      checkpoint_interval: 1000

    double_spend:
      method: finality_threshold
      threshold: 0.67

# =============================================================================
# OBSERVABILITY
# =============================================================================

observability:
  metrics:
    - blocks_produced_total
    - transactions_processed_total
    - consensus_rounds_total
    - validator_participation_rate
    - lineage_verifications_total
    - reputation_updates_total

  alerts:
    - name: low_validator_participation
      condition: "participation_rate < 0.8"
      severity: critical

    - name: block_production_stalled
      condition: "time_since_last_block > 30s"
      severity: critical

    - name: fork_detected
      condition: "competing_chains > 1"
      severity: warning
