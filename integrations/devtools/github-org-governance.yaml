# GitHub Organization Governance
# BlackRoad Enterprise - Cross-Organization Policies
#
# Defines governance, access, and compliance across all 15 organizations
#
# @blackroad_name: BlackRoad GitHub Governance
# @operator: alexa.operator.v1
# @scale: enterprise

version: "github-governance-v1"

# ============================================
# ORGANIZATION HIERARCHY
# ============================================

hierarchy:
  enterprise: "BlackRoad"

  # Organization tiers with access levels
  tiers:
    tier_1_core:
      name: "Core Platform"
      orgs: [BlackRoad-OS]
      access_level: restricted
      audit_level: comprehensive
      approval_required: true

    tier_2_product:
      name: "Product Development"
      orgs: [BlackRoad-AI, BlackRoad-Cloud, BlackRoad-Security]
      access_level: controlled
      audit_level: comprehensive
      approval_required: true

    tier_3_research:
      name: "Research & Innovation"
      orgs: [BlackRoad-Labs, BlackRoad-Foundation]
      access_level: standard
      audit_level: standard
      approval_required: false

    tier_4_creative:
      name: "Creative & Media"
      orgs: [BlackRoad-Studio, BlackRoad-Media, BlackRoad-Interactive]
      access_level: standard
      audit_level: standard
      approval_required: false

    tier_5_education:
      name: "Education"
      orgs: [BlackRoad-Education]
      access_level: open
      audit_level: minimal
      approval_required: false

    tier_6_infrastructure:
      name: "Infrastructure"
      orgs: [BlackRoad-Hardware, BlackRoad-Gov]
      access_level: restricted
      audit_level: comprehensive
      approval_required: true

    tier_7_business:
      name: "Business Operations"
      orgs: [Blackbox-Enterprises, BlackRoad-Ventures]
      access_level: restricted
      audit_level: comprehensive
      approval_required: true

    tier_8_archive:
      name: "Archive"
      orgs: [BlackRoad-Archive]
      access_level: read_only
      audit_level: minimal
      approval_required: false

# ============================================
# ACCESS CONTROL MATRIX
# ============================================

access_matrix:
  # Role definitions
  roles:
    executive:
      description: "C-level executives"
      enterprise_role: owner
      org_role: owner
      access: all_orgs

    platform_lead:
      description: "Platform engineering leadership"
      org_role: owner
      orgs: [BlackRoad-OS, BlackRoad-Cloud]

    ai_lead:
      description: "AI/ML leadership"
      org_role: owner
      orgs: [BlackRoad-AI, BlackRoad-Labs]

    security_lead:
      description: "Security leadership"
      org_role: owner
      orgs: [BlackRoad-Security, BlackRoad-Gov]

    creative_lead:
      description: "Creative leadership"
      org_role: owner
      orgs: [BlackRoad-Studio, BlackRoad-Media, BlackRoad-Interactive]

    business_lead:
      description: "Business operations leadership"
      org_role: owner
      orgs: [Blackbox-Enterprises, BlackRoad-Ventures]

    senior_engineer:
      description: "Senior software engineers"
      org_role: member
      repo_role: maintain
      orgs_by_team: true

    engineer:
      description: "Software engineers"
      org_role: member
      repo_role: write
      orgs_by_team: true

    contractor:
      description: "External contractors"
      org_role: outside_collaborator
      repo_role: write
      time_limited: true
      max_duration: 90_days

    auditor:
      description: "Security/compliance auditors"
      org_role: member
      repo_role: read
      orgs: [BlackRoad-Security, BlackRoad-Gov]

  # Cross-org team mappings
  cross_org_teams:
    platform-engineers:
      orgs: [BlackRoad-OS, BlackRoad-Cloud, BlackRoad-AI]
      permission: push

    security-team:
      orgs: [BlackRoad-Security, BlackRoad-OS, BlackRoad-Cloud, BlackRoad-Gov]
      permission: read

    devops-team:
      orgs: [BlackRoad-Cloud, BlackRoad-OS, BlackRoad-Hardware]
      permission: push

    research-team:
      orgs: [BlackRoad-Labs, BlackRoad-AI, BlackRoad-Foundation]
      permission: push

# ============================================
# SECURITY POLICIES
# ============================================

security:
  # Authentication
  authentication:
    sso_required: true
    sso_provider: auth0
    mfa_required: true
    mfa_methods:
      - webauthn
      - totp
      - sms  # backup only

    session:
      max_duration: 12h
      idle_timeout: 2h
      concurrent_sessions: 3

  # Secrets
  secrets:
    rotation_policy:
      api_keys: 90_days
      service_accounts: 180_days
      personal_tokens: 30_days

    scanning:
      push_protection: true
      alert_on_exposure: true
      auto_revoke: true

    allowed_patterns:
      - "ANTHROPIC_API_KEY"
      - "OPENAI_API_KEY"
      - "AWS_*"
      - "GCP_*"
      - "RAILWAY_*"
      - "CLOUDFLARE_*"

  # Code security
  code_security:
    codeql:
      enabled: true
      languages: [python, javascript, typescript, go, rust]
      schedule: weekly

    dependabot:
      enabled: true
      ecosystems: [npm, pip, cargo, docker, github-actions]
      schedule: weekly
      auto_merge:
        patch: true
        minor: false
        major: false

    secret_scanning:
      enabled: true
      push_protection: true

    branch_protection:
      default_branch: main
      required_reviews: 1
      dismiss_stale_reviews: true
      require_code_owner_reviews: true
      required_status_checks:
        strict: true
        contexts: [lint, test, security]
      enforce_admins: false
      allow_force_pushes: false
      allow_deletions: false

# ============================================
# REPOSITORY POLICIES
# ============================================

repository_policies:
  # Naming conventions
  naming:
    patterns:
      BlackRoad-OS: "blackroad-os-*"
      BlackRoad-AI: "lucidia-* | beacon-* | ai-*"
      BlackRoad-Cloud: "cloud-*"
      BlackRoad-Security: "security-*"
      BlackRoad-Labs: "labs-*"
      BlackRoad-Foundation: "amundson-* | community | awesome-*"
      BlackRoad-Studio: "studio-*"
      BlackRoad-Media: "media-*"
      BlackRoad-Interactive: "interactive-*"
      BlackRoad-Education: "education-*"
      BlackRoad-Hardware: "hardware-*"
      BlackRoad-Gov: "gov-*"
      Blackbox-Enterprises: "enterprise-*"
      BlackRoad-Ventures: "ventures-*"
      BlackRoad-Archive: "archive-*"

  # Required files
  required_files:
    all:
      - README.md
      - LICENSE
      - .gitignore
      - CODEOWNERS

    with_code:
      - CONTRIBUTING.md
      - SECURITY.md
      - .github/PULL_REQUEST_TEMPLATE.md

    python:
      - pyproject.toml
      - .python-version

    javascript:
      - package.json
      - .nvmrc

  # CODEOWNERS patterns
  codeowners:
    default_reviewers:
      BlackRoad-OS: "@BlackRoad-OS/platform-core"
      BlackRoad-AI: "@BlackRoad-AI/ai-core"
      BlackRoad-Cloud: "@BlackRoad-Cloud/cloud-platform"
      BlackRoad-Security: "@BlackRoad-Security/security-core"

    sensitive_paths:
      "*.lock": "@BlackRoad-Security/security-core"
      ".github/workflows/*": "@BlackRoad-Cloud/cloud-platform"
      "**/secrets/**": "@BlackRoad-Security/security-core"
      "**/auth/**": "@BlackRoad-Security/security-core"

  # Visibility rules
  visibility:
    default: private

    public_allowed:
      - BlackRoad-Foundation
      - BlackRoad-Education

    public_approval_required:
      - BlackRoad-OS
      - BlackRoad-AI
      - BlackRoad-Labs

    never_public:
      - BlackRoad-Security
      - BlackRoad-Gov
      - Blackbox-Enterprises
      - BlackRoad-Ventures

# ============================================
# COMPLIANCE & AUDIT
# ============================================

compliance:
  # Audit logging
  audit:
    enabled: true
    retention: 365_days
    streaming:
      - destination: datadog
        events: all
      - destination: splunk
        events: security

    alerts:
      - event: member_added
        notify: [security-team, org-owners]
      - event: repository_created
        notify: [org-owners]
      - event: secret_exposed
        notify: [security-team]
        severity: critical
      - event: branch_protection_disabled
        notify: [security-team]
        severity: high

  # Compliance frameworks
  frameworks:
    soc2:
      enabled: true
      controls:
        - access_reviews: quarterly
        - secrets_rotation: enforced
        - audit_logging: enabled

    gdpr:
      enabled: true
      orgs: [BlackRoad-OS, BlackRoad-AI, BlackRoad-Cloud]
      controls:
        - data_retention: enforced
        - access_logging: enabled
        - right_to_erasure: supported

    fedramp:
      enabled: true
      orgs: [BlackRoad-Gov]
      controls:
        - boundary_documentation: required
        - continuous_monitoring: enabled
        - incident_response: documented

  # Access reviews
  access_reviews:
    frequency: quarterly
    reviewers:
      - security-team
      - org-owners

    scope:
      - organization_members
      - outside_collaborators
      - team_memberships
      - repository_access
      - deploy_keys
      - oauth_apps

# ============================================
# CI/CD GOVERNANCE
# ============================================

cicd:
  # Shared workflows
  shared_workflows:
    source_org: BlackRoad-Cloud
    source_repo: cloud-github-actions

    required_workflows:
      - security-scan.yaml
      - dependency-check.yaml
      - secrets-scan.yaml

  # Runner policies
  runners:
    self_hosted:
      allowed_orgs: [BlackRoad-OS, BlackRoad-AI, BlackRoad-Cloud]
      labels:
        - self-hosted
        - linux
        - gpu

    larger_runners:
      allowed_orgs: all
      configurations:
        - name: linux-8core
          cores: 8
          memory: 32GB
        - name: linux-16core
          cores: 16
          memory: 64GB
        - name: gpu-runner
          cores: 16
          memory: 64GB
          gpu: true

  # Actions policies
  actions:
    allowed_actions: selected
    allowed_patterns:
      - "actions/*"
      - "github/*"
      - "BlackRoad-*/*"
      - "docker/*"
      - "aws-actions/*"
      - "google-github-actions/*"
      - "hashicorp/*"
      - "cloudflare/*"

    # Fork policies
    fork_pull_request_workflows:
      approval_required: true
      allowed_orgs_without_approval: []

  # Environments
  environments:
    required:
      - name: staging
        protection_rules:
          required_reviewers: 0
          wait_timer: 0

      - name: production
        protection_rules:
          required_reviewers: 1
          wait_timer: 15
          branch_policy: main

# ============================================
# PACKAGE GOVERNANCE
# ============================================

packages:
  # NPM
  npm:
    scope: "@blackroad"
    organizations:
      - BlackRoad-OS
      - BlackRoad-AI
      - BlackRoad-Studio

    publish_policy:
      approval_required: true
      required_reviews: 1
      branch: main

  # PyPI
  pypi:
    organizations:
      - BlackRoad-OS
      - BlackRoad-AI
      - BlackRoad-Labs

    publish_policy:
      approval_required: true
      required_reviews: 1
      branch: main

  # Container Registry
  containers:
    registry: ghcr.io
    organizations: all

    image_signing:
      enabled: true
      provider: cosign

    vulnerability_scanning:
      enabled: true
      block_on_critical: true

# ============================================
# INCIDENT RESPONSE
# ============================================

incident_response:
  # Severity levels
  severities:
    critical:
      description: "Security breach, data exposure, production down"
      response_time: 15_minutes
      escalation:
        - security-team
        - executive

    high:
      description: "Significant security issue, major outage risk"
      response_time: 1_hour
      escalation:
        - security-team
        - on-call

    medium:
      description: "Moderate security issue, degraded service"
      response_time: 4_hours
      escalation:
        - security-team

    low:
      description: "Minor security issue, no immediate risk"
      response_time: 24_hours
      escalation:
        - security-team

  # Response procedures
  procedures:
    secret_exposure:
      - rotate_secret_immediately
      - audit_usage
      - notify_affected_teams
      - document_incident

    unauthorized_access:
      - revoke_access
      - audit_actions
      - notify_security
      - investigate_scope

    repository_compromise:
      - quarantine_repository
      - audit_commits
      - rotate_secrets
      - rebuild_from_known_good

# ============================================
# REPORTING
# ============================================

reporting:
  dashboards:
    - name: "Security Overview"
      metrics:
        - open_vulnerabilities
        - secret_exposure_events
        - failed_authentication
        - branch_protection_violations

    - name: "Compliance Status"
      metrics:
        - access_review_completion
        - secrets_rotation_compliance
        - required_file_compliance
        - workflow_compliance

    - name: "Development Metrics"
      metrics:
        - pull_request_velocity
        - code_review_time
        - deployment_frequency
        - change_failure_rate

  scheduled_reports:
    - name: "Weekly Security Report"
      frequency: weekly
      recipients: [security-team, executive]

    - name: "Monthly Compliance Report"
      frequency: monthly
      recipients: [compliance-team, executive]

    - name: "Quarterly Access Review"
      frequency: quarterly
      recipients: [security-team, hr-team, executive]
