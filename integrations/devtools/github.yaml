# GitHub Configuration
# BlackRoad OS Development Platform
#
# Repository management, CI/CD, and collaboration
#
# @blackroad_name: BlackRoad GitHub
# @tier: Team
# @operator: alexa.operator.v1

version: "github-v1"

# ============================================
# ORGANIZATION
# ============================================

organization:
  name: "blackroad"
  display_name: "BlackRoad"
  email: "dev@blackroad.io"
  blog: "https://blackroad.io"

  settings:
    default_repository_permission: read
    members_can_create_repositories: false
    members_can_create_private_repositories: false
    members_can_create_public_repositories: false
    members_can_fork_private_repositories: true
    web_commit_signoff_required: true

# ============================================
# REPOSITORIES
# ============================================

repositories:
  # Core platform
  blackroad-os-operator:
    description: "BlackRoad OS Governance Engine"
    visibility: private
    topics:
      - ai
      - governance
      - multi-agent
      - python
      - fastapi

    settings:
      has_issues: true
      has_projects: true
      has_wiki: false
      has_discussions: true
      allow_squash_merge: true
      allow_merge_commit: false
      allow_rebase_merge: true
      delete_branch_on_merge: true
      allow_auto_merge: true

    branch_protection:
      main:
        required_status_checks:
          strict: true
          contexts:
            - "test"
            - "lint"
            - "type-check"
        required_pull_request_reviews:
          required_approving_review_count: 1
          dismiss_stale_reviews: true
          require_code_owner_reviews: true
        enforce_admins: false
        restrictions: null

    codeowners: |
      * @blackroad/platform-team
      /br_operator/policy_engine* @blackroad/governance-team
      /br_operator/ledger* @blackroad/governance-team

  # Web application
  blackroad-web:
    description: "BlackRoad OS Web Application"
    visibility: private
    topics:
      - nextjs
      - react
      - typescript

    branch_protection:
      main:
        required_status_checks:
          contexts:
            - "build"
            - "test"
            - "lint"

  # Lucidia platform
  lucidia:
    description: "Lucidia AI Agent Platform"
    visibility: private
    topics:
      - ai
      - agents
      - python

  # Documentation
  blackroad-docs:
    description: "BlackRoad OS Documentation"
    visibility: public
    topics:
      - documentation

  # SDKs
  blackroad-sdk-python:
    description: "BlackRoad OS Python SDK"
    visibility: public
    topics:
      - sdk
      - python

  blackroad-sdk-typescript:
    description: "BlackRoad OS TypeScript SDK"
    visibility: public
    topics:
      - sdk
      - typescript

# ============================================
# TEAMS
# ============================================

teams:
  platform-team:
    description: "Core platform development"
    privacy: closed
    permission: push
    members:
      - alexa

  governance-team:
    description: "Governance and policy"
    privacy: closed
    permission: push

  frontend-team:
    description: "Web and mobile development"
    privacy: closed
    permission: push

  devrel-team:
    description: "Developer relations"
    privacy: closed
    permission: push

# ============================================
# GITHUB ACTIONS
# ============================================

actions:
  # Allowed actions
  allowed_actions: selected
  github_owned_allowed: true
  verified_allowed: true

  patterns_allowed:
    - "actions/*"
    - "github/*"
    - "docker/*"

  # Secrets
  secrets:
    organization:
      - ANTHROPIC_API_KEY
      - OPENAI_API_KEY
      - RAILWAY_TOKEN
      - CLOUDFLARE_API_TOKEN
      - SENTRY_DSN
      - DATADOG_API_KEY

    repository:
      blackroad-os-operator:
        - DATABASE_URL
        - REDIS_URL
        - PINECONE_API_KEY

  # Variables
  variables:
    organization:
      - ENVIRONMENT: production
      - REGISTRY: ghcr.io/blackroad

# ============================================
# WORKFLOWS
# ============================================

workflows:
  # CI workflow template
  ci:
    name: "CI"
    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main]

    jobs:
      test:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: actions/setup-python@v5
            with:
              python-version: "3.12"
          - run: pip install -e ".[dev]"
          - run: pytest tests/ -v

      lint:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: actions/setup-python@v5
          - run: pip install ruff
          - run: ruff check .

      type-check:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: actions/setup-python@v5
          - run: pip install mypy
          - run: mypy br_operator/

  # Release workflow
  release:
    name: "Release"
    on:
      push:
        tags: ["v*"]

    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - uses: docker/build-push-action@v5
            with:
              push: true
              tags: ghcr.io/blackroad/blackroad-os:${{ github.ref_name }}

      deploy:
        needs: build
        runs-on: ubuntu-latest
        steps:
          - uses: railway/deploy@v1
            with:
              service: blackroad-os-api

# ============================================
# GITHUB APPS
# ============================================

apps:
  # Dependabot
  dependabot:
    enabled: true
    config:
      version: 2
      updates:
        - package-ecosystem: pip
          directory: "/"
          schedule:
            interval: weekly
          groups:
            python-packages:
              patterns:
                - "*"

        - package-ecosystem: github-actions
          directory: "/"
          schedule:
            interval: weekly

  # CodeQL
  codeql:
    enabled: true
    languages:
      - python

  # Secret scanning
  secret_scanning:
    enabled: true
    push_protection: true

# ============================================
# WEBHOOKS
# ============================================

webhooks:
  # Slack notifications
  slack:
    url: "${SLACK_GITHUB_WEBHOOK}"
    events:
      - push
      - pull_request
      - issues
      - release

  # Discord notifications
  discord:
    url: "${DISCORD_WEBHOOK_GITHUB}"
    events:
      - push
      - pull_request
      - release

  # Deployment trigger
  railway:
    url: "https://backboard.railway.app/webhooks/github"
    events:
      - push

# ============================================
# ISSUE TEMPLATES
# ============================================

issue_templates:
  bug_report:
    name: "Bug Report"
    description: "Report a bug"
    labels:
      - bug
    body:
      - type: textarea
        label: "Description"
        description: "Describe the bug"
        required: true

      - type: textarea
        label: "Steps to Reproduce"
        required: true

      - type: textarea
        label: "Expected Behavior"
        required: true

      - type: dropdown
        label: "Severity"
        options:
          - Critical
          - Major
          - Minor

  feature_request:
    name: "Feature Request"
    description: "Request a new feature"
    labels:
      - enhancement
    body:
      - type: textarea
        label: "Description"
        required: true

      - type: textarea
        label: "Use Case"
        required: true

# ============================================
# PR TEMPLATES
# ============================================

pull_request_template: |
  ## Summary
  <!-- Brief description of changes -->

  ## Type of Change
  - [ ] Bug fix
  - [ ] New feature
  - [ ] Breaking change
  - [ ] Documentation

  ## Testing
  - [ ] Tests added/updated
  - [ ] Manual testing performed

  ## Checklist
  - [ ] Code follows style guidelines
  - [ ] Self-review completed
  - [ ] Documentation updated
