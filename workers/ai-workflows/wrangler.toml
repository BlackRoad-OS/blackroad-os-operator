#:schema node_modules/wrangler/config-schema.json
name = "blackroad-ai-workflows"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Account info
account_id = "848cf0b18d51e0170e0d1537aec3505a"

# Workers AI binding
[ai]
binding = "AI"

# KV for state storage
[[kv_namespaces]]
binding = "WORKFLOW_STATE"
id = "ai_workflows_prod"

# D1 for ledger/history
[[d1_databases]]
binding = "LEDGER"
database_name = "ai_workflows_ledger"
database_id = "ai-workflows-ledger"

# Environment variables
[vars]
OPERATOR_URL = "https://operator.blackroad.systems"
ENVIRONMENT = "production"

# Secrets (set via wrangler secret put)
# LINEAR_API_KEY
# NOTION_API_KEY
# HUGGINGFACE_API_KEY

# Routes
routes = [
  { pattern = "ai-workflows.blackroad.systems/*", zone_name = "blackroad.systems" }
]

# Limits
[limits]
cpu_ms = 50000  # 50 seconds for AI processing

# Triggers (cron jobs)
[triggers]
crons = ["0 */6 * * *"]  # Every 6 hours - cleanup old state
