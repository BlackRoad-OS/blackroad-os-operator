# BlackRoad OS - API Gateway Worker
# Edge routing, rate limiting, and request proxying to Railway backend
#
# @blackroad_name: API Gateway Worker
# @operator: alexa.operator.v1

name = "blackroad-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# Enable workers.dev subdomain
workers_dev = true

[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"
OPERATOR_URL = "https://blackroad-cece-operator-production.up.railway.app"

# Routes - serve api.blackroad.io
routes = [
  { pattern = "api.blackroad.io/*", zone_name = "blackroad.io" },
]

# KV Namespaces
[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "eaf62d1acdb04fa695d817073ff23830"

[[kv_namespaces]]
binding = "CACHE"
id = "c878fbcc1faf4eddbc98dcfd7485048d"

# Durable Objects for session state
[[durable_objects.bindings]]
name = "SESSIONS"
class_name = "SessionDO"

[[migrations]]
tag = "v1"
new_classes = ["SessionDO"]

# Observability
[observability]
enabled = true
